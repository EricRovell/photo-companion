<script lang="ts">
	import { Link, Gauge } from "@lib/components";
	import { urlLightsScheduleSourceSPb, urlLightsScheduleSourceMoscow, urlPWA, urlSuncalcNpm } from "@lib/routes";
	import { LIGHTS_SCHEDULE_DATE, title } from "@lib/constants";
</script>

## Общая информация

"{title}" — веб приложение, позволяющие получать необходимую и актуальную информацию для фотографа: актуальное расписание переключения городской подсветки, времён заката и восхода Солнца и Луны.

Веб-приложение поддерживает установку как самостоятельное приложение в формате [Progressive Web Application]({urlPWA}). Для функционирования не требуется дополнительных прав, при установке работает без сети интернет и потребляет мало ресурсов. Оповещения об обновлении приходят автоматически.

### События

Здесь отображаются события в виде временной шкалы от текущего заданного времени до конца следующих суток.

Отображаются следующие события:

- Солнце: времена восхода, захода, типов сумерек;
- Луна: времена восхода и захода;
- Освещение: времена включения и отключения городского освещения в заданном городе;
- Разводные мосты г.Санкт-Петербурга: времена развода и сведения мостов.

Те или иные события можно отфильтровать или полностью отключить в [разделе пользовательских настроек](/settings).

### Городское освещение

Здесь отображена информация о переключении городской подсветки в выбранном городе с учётом заданных даты и времени. Помимо этого во вкладке присутствует таймер отсчёта до следующего переключения наружного освещения.

Поддерживаются следующие города:

- г.Санкт-Петербург — [источник]({urlLightsScheduleSourceSPb}) за 2024 год;
- г.Москва — [источник]({urlLightsScheduleSourceMoscow}) за 2024 год;

<aside data-note>
	<p>Важно помнить, данные графиков составляются с учётом фактических атмосферных условий города. Включение и отключение наружного освещения, по информации составителей, разрешается с отклонением от графика на 30 минут в обе стороны.</p>
</aside>

Если в этих данных нет необходимости, провайдер можно отключить в [разделе пользовательских настроек](/settings). Важно, в таком случае пропадёт информация во разделе "События". Там же можно и поменять город по умолчанию.

### Солнце

Здесь отображается вся необходимая информация, связанная с Солнцем. Во вкладке присутствует виджет отображения времён восхода и захода Солнца в формате пончиковой диаграммы.

<aside data-note>
	<p>Для отображения данных используются геолокационные данные. Подробнее о них ниже в разделе пользовательских настроек.</p>
</aside>

### Луна

Здесь отображается вся необходимая информация, связанная с Луной. Во вкладке присутствует виджет отображения времён восхода и захода Луны в формате пончиковой диаграммы. Помимо этого отображены даты последующих основных Лунных фаз.

<aside data-note>
	<p>Для отображения данных используются геолокационные данные. Подробнее о них ниже в разделе пользовательских настроек.</p>
</aside>

### Разводные мосты г.Санкт-Петербург

Здесь отображено актуальное расписание разводных мостов г.Санкт-Петербург в виде диаграммы со временем развода и сведения. По умолчания данный раздел и события (в разделе Событий) активируются лишь во время навигации — когда мосты действительно разводятся. При необходимости раздел можно активировать в любое время, либо убрать совсем в разделе пользовательских настроек.

### Пользовательские настройки

В данном разделе пользователь можно изменить то или иное поведение приложения.

- **Стартовая страница** — какой раздел должен стать разделом по умолчанию при загрузке приложения или переходе по заголовку;
- **Геолокация** — здесь можно указать желаемые данные или запросить их с утройства (потребуется разрешение);
- **Городское освещение** — расписание какого города необходимо отображать, либо имеется возможность отключить разде совсем (отключение убирает и события);
- **Разводные мосты г.Санкт-Петербург** — по умолчанию раздел становится доступен во время навигации. При желании раздел можно активировать в любое время, либо отключить совсем. Важно, события в последнем случае деактивируются.
- **Фильтры событий** — позволяет точечно либо настроить какие события должны быть отображены во вкладке Событий, либо отключить те или иные группы полностью.

<aside data-note>
	<p>Для того, чтобы настройки вступили в силу, необходимо нажать кнопку "Сохранить".</p>
</aside>

Пользовательские настройки хранятся локально на устройстве. При очистке кэша — они пропадут. В случае несовместимых будущих обновлений настройки могут быть стёрты для предотвращения ошибок несовместимости. В подобных случаях об этом будет упомянуто в [списке изменений](/changelog).

## Замечания

### Пончиковая диаграмма

В разделе **Освещение** и **Луна** для визуализации данных используется "пончиковая" диаграмма (для Солнца данное замечание не имеет значения). Важно понимать, что она отображает данные о времени событий за конкретные сутки. Иногда, те или иные события охватывают несколько суток, например, Луна взошла сегодня и зайдёт за горизонт только завтра. В таких случаях на диаграмме появляется вертикальный разделитель, рассекающий шкалу; это даёт понять, что события уходят за пределы рассматриваемых суток.
Рассмотрим пример ниже. Некоторое событие началось в 18:00 часов и продолжилось до окончания дня, уходя в завтрашние сутки. Таким же образом, уже другое событие началось в некоторое неизвестное время вчера и продолжалось до текущих суток до 6:00 часов.

<aside>
	<Gauge
		angleStart="{270}"
		angleEnd="{90}"
		labelStart="18:00"
		labelEnd="6:00"
	/>
</aside>

Такое отображение данных не всегда удобно, но имеет свои плюсы. Для более комфортного планирования используется вкладку "События".

### Расчёты эфемерид

Расчёты Эфимирид происходят локально, используется форк библиотеки [SunCalc]({urlSuncalcNpm}). Благодаря этому расчёты происходят полностью на устройстве и не требуют подключения к сети интернет. Важно понимать, что расчёты могут иметь погрешности не и не учитывать некоторых факторов. Имеющейся погрешности более чем достаточно для планирования. В будущем планируется самостоятельно изучить данную тему, расширить количество доступных данных и улучшить показатели.
