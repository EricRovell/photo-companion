<script lang="ts">
	import { Link, Gauge } from "@lib/components";
	import { urlScheduleSource, urlSheduleDocument, urlPWA, urlSuncalcNpm } from "@lib/routes";
	import { LIGHTS_SCHEDULE_DATE, title } from "@lib/constants";
</script>

## Общая информация

"{title}" — веб приложение, позволяющие получать необходимую и актуальную информацию для фотографа, находящемуся в городе Санкт-Петербург: актуальное расписание переключения городской подсветки, время заката и восхода Солнца и Луны.

<aside data-note>
	<p>В дальнейшем планируется добавить возможность менять местоположение, Санкт-Петербургом всё не ограничивается.</p>
</aside>

Веб-приложение поддерживает установку как отдельное приложение в формате [Progressive Web Application]({urlPWA}). Для функционирования не требует дополнительных прав, при установке работает без сети интернет и потребляет мало ресурсов. Обновления приходят автоматически после перезапуска.

Функционал разбит на 4 вкладки. Управление данными каждой из них происходит с помощью поля ввода даты и времени, расположенного у нижнего края экрана.

### События

В данной вкладке отображаются сводные данные в виде временной шкалы от заданных даты и времени до конца **последующих** суток. Последующие сутки отображаются для удобства планирования.

### Городское освещение

В данной вкладке отображена информация о переключении городской подсветки в городе Санкт-Петербург с учётом выбранных даты и времени. Помимо этого во вкладке присутствует таймер отсчёта до следующего переключения наружного освещения.

Веб-приложение использует данные о [графике наружного освещения в Санкт-Петербурге]({urlScheduleSource}) на [{LIGHTS_SCHEDULE_DATE} год]({urlSheduleDocument}).

<aside data-note>
	<p>Важно помнить, данный график составлен с учётом фактических атмосферных условий Санкт-Петербурга. Включение и отключение наружного освещения, по информации составителей, разрешается с отклонением от графика на плюс-минус 30 минут.</p>
</aside>

{#if LIGHTS_SCHEDULE_DATE === new Date().getFullYear()}
	<aside data-note="success">
		<p>Используется актуальное расписание на текущий <strong>{LIGHTS_SCHEDULE_DATE}</strong> год.</p>
	</aside>
{:else}
	<aside data-note="danger">
		<p>Расписание на текущий <strong>{LIGHTS_SCHEDULE_DATE}</strong> год не актуально. Пожалуйста, свяжитесь с автором и попросите обновить данные.</p>
		<p>Для отображения данных продолжают использоваться последние имеющиеся данные расписания за {LIGHTS_SCHEDULE_DATE} год. Обычно ежегодные изменения не претерпевают серьёзных изменений, поэтому пользоваться ими в большей степени безопасно.</p>
	</aside>
{/if}

### Солнце

На данной вкладке отображается вся необходимая информация, связанная с Солнцем.

Во вкладке присутствует виджет отображения времён восхода и захода Солнца в формате пончиковой диаграммы.

<aside data-note>
	<p>Данная вкладка находится в разработке, функционал распланирован.</p>
</aside>

### Луна

На данной вкладке отображается вся необходимая информация, связанная с Луной.

Во вкладке присутствует виджет отображения времён восхода и захода Луны в формате пончиковой диаграммы. Помимо этого отображены даты последующих основных Лунных фаз.

<aside data-note>
	<p>Данная вкладка находится в разработке, функционал распланирован.</p>
</aside>

## Замечания

### Пончиковая диаграмма

В разделе **Освещение** и **Луна** для визуализации данных используется "пончиковая" диаграмма (для Солнца данное замечание не имеет значения). Важно понимать, что она отображает данные о времени событий за конкретные сутки. Иногда, те или иные события охватывают несколько суток, например, Луна взошла сегодня и зайдёт за горизонт только завтра. В таких случаях на диаграмме появляется вертикальный разделитель, рассекающий шкалу; это даёт понять, что события уходят за пределы рассматриваемых суток.
Рассмотрим пример ниже. Некоторое событие началось в 18:00 часов и продолжилось до окончания дня, уходя в завтрашние сутки. Таким же образом, уже другое событие началось в некоторое неизвестное время вчера и продолжалось до текущих суток до 6:00 часов.

<aside>
	<Gauge
		angleStart="{270}"
		angleEnd="{90}"
		labelStart="18:00"
		labelEnd="6:00"
	/>
</aside>

Такое отображение данных не всегда удобно, но имеет свои плюсы. Для более комфортного планирования используется вкладку "События".

### Расчёты эфемерид

Для рассчётов используется замечательная библиотека [SunCalc]({urlSuncalcNpm}). Благодаря нему расчёты происходят полностью на устройстве и не требуют подключения к сети интернет. Важно понимать, что расчёты могут иметь погрешности не и не учитывать некоторых факторов. Имеющейся погрешности более чем достаточно для планирования. В будущем планируется самостоятельно изучить данную тему и улучшить показатели.
